---
- hosts: all
  tasks:
    - name: Ensure IIS is enabled
      win_feature:
        name: Web-Server
        state: present
      become: True
    - name: Ensure that there is no binding on HTTP port
      win_iis_webbinding:
        name: Default Web Site
        port: 80
        state: absent
      become: True
      when: iis_https_exception is false
    - name: Ensure that there is the binding on HTTPS port
      win_iis_webbinding:
        name: Default Web Site
        protocol: https
        port: 443
        certificate_hash: B0D0FA8408FC67B230338FCA584D03792DA73F4C
      become: True
      when: iis_https_exception is false
    - name: Ensure that there is the binding on HTTP port
      win_iis_webbinding:
        name: Default Web Site
        port: 80
      become: True
      when: iis_https_exception is true
    - name: Ensure that there is no binding on HTTPS port
      win_iis_webbinding:
        name: Default Web Site
        protocol: https
        port: 443
        certificate_hash: B0D0FA8408FC67B230338FCA584D03792DA73F4C
        state: absent
      become: True
      when: iis_https_exception is true
